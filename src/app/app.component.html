<mat-toolbar color="primary">
  <mat-toolbar-row>
    @if (headline$ | async; as headline){
    <span class="header-title non-selectable">
      <mat-icon>{{ headline.icon }}</mat-icon> {{ headline.title }}
    </span>
    } @if (user$ | async; as user) {
    <button
      mat-icon-button
      class="header-menu"
      color="primary"
      [matBadge]="(hasUpdates$ | async) ? '!' : null"
      matBadgeColor="warn"
      matBadgeSize="small"
      matBadgePosition="below after"
      [matMenuTriggerFor]="menu"
    >
      <img [ngClass]="{ online: isOnline$ | async }" class="avatar" width="38" height="38" [src]="user.picture" />
    </button>
    }
  </mat-toolbar-row>
</mat-toolbar>
<div class="progress-container">
  <mat-progress-bar *ngIf="loading$ | async" mode="indeterminate"></mat-progress-bar>
</div>

<mat-menu #menu="matMenu">
  <button mat-menu-item [routerLink]="[route.dashboard]" queryParamsHandling="preserve" [replaceUrl]="true">
    <mat-icon class="main-menu-icon">dashboard</mat-icon> <span>Dashboard</span>
  </button>

  <button
    mat-menu-item
    [routerLink]="[route.dashboard, route.categories]"
    queryParamsHandling="preserve"
    [disabled]="(isOnline$ | async) === false"
  >
    <mat-icon class="main-menu-icon">category</mat-icon> <span>Categories</span>
  </button>

  <button
    mat-menu-item
    [routerLink]="[route.dashboard, route.stats]"
    queryParamsHandling="preserve"
    [disabled]="(isOnline$ | async) === false"
  >
    <mat-icon class="main-menu-icon">query_stats</mat-icon> <span>Statistics</span>
  </button>

  <button mat-menu-item [routerLink]="[route.setup, route.settings]" queryParamsHandling="preserve" [replaceUrl]="true">
    <mat-icon class="main-menu-icon">settings</mat-icon> <span>Setup</span>
  </button>

  <button mat-menu-item>
    <mat-icon class="main-menu-icon">open_in_new</mat-icon>
    <a
      [href]="'https://docs.google.com/spreadsheets/d/' + (spreadsheetId$ | async) + '/edit'"
      target="_blank"
      rel="noopener noreferrer"
    >
      Open Spreadsheet
    </a>
  </button>

  @if (hasUpdates$ | async) {
  <button mat-menu-item (click)="update()">
    <mat-icon class="main-menu-icon" matBadge="!" matBadgeSize="small" matBadgeColor="warn">system_update</mat-icon>
    <span>Update</span>
  </button>
  }

  <button mat-menu-item (click)="logout()" [disabled]="(isOnline$ | async) === false">
    <mat-icon class="main-menu-icon">logout</mat-icon> <span>Logout</span>
  </button>

  <div mat-menu-item disabled style="justify-content: end">version: {{ version }}</div>
</mat-menu>

<div class="content">
  <router-outlet></router-outlet>
</div>
